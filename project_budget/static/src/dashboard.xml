<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

<t t-name="project_budget.dashboard_template" owl="1">
    <Layout display="display">
        <t t-set-slot="control-panel-bottom-left">
            <button class="btn btn-primary" t-on-click="openCustomerView"> Customers </button>
            <button class="btn btn-primary" t-on-click="openLast7DaysOrders"> New Projects </button>
            <button class="btn btn-primary" t-on-click="openLast7DaysCancelledOrders"> Cancelled Projects </button>
            <select style="width:100px" class="form-select" t-model="state.type" t-on-change="onChangeType">
                <option value="summary">Summary</option>
                <option value="contracting">Contracting</option>
                <option value="cash">Cash</option>
                <option value="acceptance">Acceptance</option>
                <option value="margin_income">Margin</option>
            </select>
            <select style="width:100px" class="form-select" t-model="state.period" t-on-change="onChangePeriod">
                <option value="Y">Year</option>
                <option value="Q1">Q1</option>
                <option value="Q2">Q2</option>
                <option value="Q3">Q3</option>
                <option value="Q4">Q4</option>
            </select>
            <select style="width:100px" class="form-select" t-model="state.year" t-on-change="onChangeYear">
                <option t-att-value="new Date().getFullYear() - 1"><span t-esc="new Date().getFullYear() - 1"/></option>
                <option t-att-value="new Date().getFullYear()"><span t-esc="new Date().getFullYear()"/></option>
                <option t-att-value="new Date().getFullYear() + 1"><span t-esc="new Date().getFullYear() + 1"/></option>
            </select>
        </t>
    </Layout>

    <div class="m-2 container-fluid">
        <t t-foreach="statistics['offices'][state.year]" t-as="office" t-key="office">
            <h4 t-esc="office"/>
            <t t-if="statistics['plans_data'][state.year][office]">
                <div class="row">
                    <t t-foreach="['contracting', 'cash', 'acceptance', 'margin_income']" t-as="type" t-key="type">
                        <t t-if="state.type == type or state.type == 'summary'">
                            <t t-foreach="['Y', 'Q1', 'Q2', 'Q3', 'Q4']" t-as="period" t-key="period">
                                <t t-if="(state.period == period and period != 'Y') or (state.period == 'Y' and state.type != 'summary' and period != 'Y') or (state.type == 'summary' and state.period == period and period == 'Y')">
                                    <Card className="'col-2 col-md-3 shadow-sm border m-2 bg-white'">
                                        <t t-set-slot="title" t-esc="office + ' ' + type + ' ' + ' ' + state.year + period"/>
                                        <PieChart data="statistics['plans_data'][state.year][office]" period="period" type="type"/>
                                        <h2 style="width: 100%; height: 40px; position: absolute; top: 49%; left: 4px; margin-top: 0px; line-height: 6px; text-align: center; z-index: 999999999999999">
                                            <t t-esc="statistics['plans_data'][state.year][office][type][period][3]"/>
                                        </h2>
                                        <t t-set-slot="legend" t-esc="'Plan: ' + statistics['plans_data'][state.year][office][type][period][0][0] + ' / Fact: ' + statistics['plans_data'][state.year][office][type][period][0][1]"/>
                                    </Card>
                                    <Card t-if="statistics['kam_plans_data'][state.year][office] and state.period != 'Y' and state.type != 'summary'" className="'col-2 col-md-3 shadow-sm border m-2 bg-white'">
                                        <t t-set-slot="title" t-esc="office + ' ' + type + ' ' + ' ' + state.year + period"/>
                                        <BarChart data="statistics['kam_plans_data'][state.year][office]" period="period" type="type" chart_height="statistics['kam_height'][state.year][office]"/>
                                    </Card>
                                </t>
                            </t>
                        </t>
                    </t>
                </div>
            </t>
            <t t-if="statistics['kam_plans_data'][state.year][office] and (state.period == 'Y' or state.type == 'summary') or statistics['kam_plans_data'][state.year][office] and statistics['plans_data'][state.year][office] == False">
                <div class="row">
                    <t t-foreach="['contracting', 'cash', 'acceptance', 'margin_income']" t-as="type" t-key="type">
                        <t t-if="state.type == type or state.type == 'summary'">
                            <t t-foreach="['Y', 'Q1', 'Q2', 'Q3', 'Q4']" t-as="period" t-key="period">
                                <t t-if="(state.period == period and period != 'Y') or (state.period == 'Y' and state.type != 'summary' and period != 'Y') or (state.type == 'summary' and state.period == period and period == 'Y')">
                                    <Card className="'col-2 col-md-3 shadow-sm border m-2 bg-white'">
                                        <t t-set-slot="title" t-esc="office + ' ' + type + ' ' + ' ' + state.year + period"/>
                                        <BarChart data="statistics['kam_plans_data'][state.year][office]" period="period" type="type" chart_height="statistics['kam_height'][state.year][office]"/>
                                    </Card>
                                </t>
                            </t>
                        </t>
                    </t>
                </div>
            </t>
            <hr/>
        </t>
    </div>
</t>

<t t-name="project_budget.clientaction.statistics" owl="1">
    <div class="d-flex flex-nowrap">
        <div t-foreach="keyToString" t-as="key" t-key="key" class="m-2">
            <Card>
                <t t-set-slot="title"><t t-esc="keyToString[key]"/></t>
                <p class="card-text"><t t-esc="statistics[key]"/></p>
            </Card>
        </div>
    </div>
</t>

</templates>
